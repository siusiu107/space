<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ›’ ìƒì  - íƒœì–‘ê³„ ì •ë³µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root{
      --bg: radial-gradient(circle at top, #0f172a 0%, #020617 40%, #000 100%);
      --panel: rgba(8,10,16,0.55);
      --panel-solid: rgba(10,12,20,0.9);
      --stroke: rgba(255,255,255,0.06);
      --txt: #e2f3ff;
      --muted: #96b7d3;
      --accent: #00d0ff;
      --danger: #ff6b6b;
      --round: 14px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--txt);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      height:100vh;
      display:flex;
      flex-direction:column;
    }
    /* ìƒë‹¨ ë°” */
    header{
      padding:8px 12px 6px;
      border-bottom:1px solid rgba(255,255,255,0.04);
      background:rgba(2,6,12,0.35);
      backdrop-filter:blur(8px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .title-area{
      display:flex; align-items:center; gap:8px;
    }
    .title-icon{
      width:34px; height:34px; border-radius:12px;
      background:linear-gradient(180deg, #00d0ff, #0070ff);
      display:flex; align-items:center; justify-content:center;
      font-size:19px; color:#00101a; font-weight:700;
      border:1px solid rgba(255,255,255,0.35);
      box-shadow:0 10px 20px rgba(0,0,0,0.25);
    }
    .title-text{ font-weight:700; line-height:1.1; }
    .title-sub{ font-size:11px; color:var(--muted); }

    .balance{
      display:flex; gap:10px; align-items:center;
      font-size:13px;
    }
    .bal-box{
      display:flex; gap:6px; align-items:center;
      background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.03);
      border-radius:12px;
      padding:4px 10px;
    }
    .bal-label{opacity:0.65; font-size:11px;}
    .bal-value{font-weight:700; font-variant-numeric:tabular-nums;}

    /* ë ˆì´ì•„ì›ƒ */
    .wrap{
      flex:1;
      display:flex;
      min-height:0;
    }
    nav{
      width:152px;
      border-right:1px solid rgba(255,255,255,0.03);
      background:rgba(0,0,0,0.08);
      padding:8px 6px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .tab-btn{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid transparent;
      background:transparent;
      color:var(--txt);
      text-align:left;
      cursor:pointer;
      display:flex;
      gap:6px;
      align-items:center;
      font-size:13px;
    }
    .tab-btn small{color:var(--muted); font-size:11px;}
    .tab-btn.active{
      background:linear-gradient(180deg, rgba(0,208,255,0.35), rgba(0,94,191,0));
      border:1px solid rgba(0,214,255,0.45);
      box-shadow:0 6px 18px rgba(0,227,255,0.15);
    }

    main{
      flex:1;
      padding:10px 10px 16px;
      overflow-y:auto;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-content:flex-start;
    }
    .section-title{
      width:100%;
      font-size:13px;
      opacity:0.75;
      margin-bottom:2px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .section-title small{font-size:11px; color:var(--muted);}

    .item{
      width:calc(33.33% - 8px);
      min-width:210px;
      background:radial-gradient(circle at 10% 10%, rgba(255,255,255,0.05), rgba(0,0,0,0));
      border:1px solid rgba(255,255,255,0.03);
      border-radius:12px;
      padding:10px 10px 9px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .item-top{
      display:flex; gap:10px; align-items:flex-start;
    }
    .item-icon{
      width:34px; height:34px; border-radius:10px;
      background:rgba(0,208,255,0.12);
      display:flex; align-items:center; justify-content:center;
      font-size:18px;
    }
    .item-name{ font-weight:700; }
    .item-desc{ font-size:12px; color:var(--muted); line-height:1.35; }
    .price-row{
      display:flex; gap:6px; align-items:center; flex-wrap:wrap;
    }
    .price{
      display:inline-flex; gap:4px; align-items:center;
      background:rgba(0,0,0,0.22);
      border:1px solid rgba(255,255,255,0.03);
      border-radius:999px;
      padding:2px 8px 2px 6px;
      font-size:11px;
    }
    .price span{font-variant-numeric:tabular-nums;}
    .btn-buy{
      margin-top:4px;
      background:linear-gradient(180deg,#00d0ff,#0090ff);
      border:none;
      border-radius:999px;
      padding:6px 10px;
      color:#001018;
      font-weight:700;
      cursor:pointer;
      font-size:12px;
      display:inline-flex;
      gap:4px;
      align-items:center;
    }
    .btn-buy:disabled{
      opacity:0.5;
      cursor:not-allowed;
    }
    .badge{
      display:inline-flex; align-items:center; gap:3px;
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.05);
      border-radius:999px;
      padding:2px 10px;
      font-size:11px;
    }

    /* í† ìŠ¤íŠ¸ */
    #toast{
      position:fixed; left:50%; bottom:14px; transform:translateX(-50%) translateY(20px);
      background:rgba(0,0,0,0.80);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:10px;
      padding:6px 12px;
      font-size:12px; color:#fff;
      display:none;
      z-index:9999;
    }

    @media (max-width:900px){
      .item{ width:calc(50% - 8px); }
      nav{width:128px;}
    }
    @media (max-width:640px){
      header{ flex-wrap:wrap; }
      .balance{ width:100%; justify-content:flex-end; }
      .item{ width:100%; }
      .wrap{flex-direction:column;}
      nav{width:100%; flex-direction:row; overflow-x:auto;}
      .tab-btn{white-space:nowrap;}
    }
  </style>
</head>
<body>
  <header>
    <div class="title-area">
      <div class="title-icon">ğŸ›’</div>
      <div>
        <div class="title-text">ìƒì </div>
        <div class="title-sub">íƒœì–‘ê³„ ì •ë³µ: ìš°ì£¼ ìƒì¡´ í´ë¦­ì»¤</div>
      </div>
    </div>
    <div class="balance">
      <div class="bal-box" id="bal-coins">
        <span class="bal-label">ì½”ì¸</span>
        <span class="bal-value" id="coins-amount">ì•Œ ìˆ˜ ì—†ìŒ</span>
      </div>
      <div class="bal-box" id="bal-ecoins">
        <span class="bal-label">ì´ë²¤íŠ¸ì½”ì¸</span>
        <span class="bal-value" id="ecoins-amount">ì•Œ ìˆ˜ ì—†ìŒ</span>
      </div>
    </div>
  </header>

  <div class="wrap">
    <nav>
      <button class="tab-btn active" data-tab="featured">â­ ì¶”ì²œ</button>
      <button class="tab-btn" data-tab="buffs">âš¡ ë²„í”„</button>
      <button class="tab-btn" data-tab="packs">ğŸ“¦ ìì›íŒ©</button>
      <button class="tab-btn" data-tab="misc">ğŸ§° ê¸°íƒ€</button>
    </nav>
    <main id="main-area">
      <!-- ì—¬ê¸° ë‚´ìš©ì€ JSì—ì„œ ë Œë” -->
    </main>
  </div>

  <div id="toast"></div>

  <script>
  // ===============================
  // ê°„ë‹¨ ë°ì´í„°: ìƒì  ì•„ì´í…œ
  // ===============================
  const SHOP_ITEMS = {
    featured: [
      {
        id: 'buff_coin_5m',
        icon: 'âš¡',
        name: 'ì½”ì¸ ë²„í”„ 50% (5ë¶„)',
        desc: '5ë¶„ ë™ì•ˆ ì½”ì¸ íšë“ëŸ‰ +50%.',
        priceCoin: 120,
        priceEvent: 0,
        give: { type: 'buff', buffType:'coin', buffValue:0.5, buffDurMs:5*60*1000 }
      },
      {
        id: 'res_pack_500',
        icon: 'ğŸª¨',
        name: 'ìì› 500íŒ©',
        desc: 'ì¦‰ì‹œ ìì› +500. ì´ˆë°˜ ì„±ì¥ìš©.',
        priceCoin: 60,
        priceEvent: 0,
        give: { type: 'res', amount: 500 }
      },
      {
        id: 'event_pack_small',
        icon: 'ğŸŸï¸',
        name: 'ì´ë²¤íŠ¸ì½”ì¸ x3',
        desc: 'ì´ë²¤íŠ¸ ìŠ¬ë¡¯ì„ ìì£¼ ëŒë¦¬ê³  ì‹¶ì„ ë•Œ.',
        priceCoin: 0,
        priceEvent: 2, // ì´ë²¤íŠ¸ì½”ì¸ìœ¼ë¡œë„ íŒŒëŠ” ì˜ˆì‹œ
        give: { type: 'event', amount: 3 }
      }
    ],
    buffs: [
      {
        id: 'buff_all_10m',
        icon: 'ğŸ’«',
        name: 'ì „ì²´ íšë“ +30% (10ë¶„)',
        desc: 'ìì›/ì½”ì¸ ì „ë¶€ +30%.',
        priceCoin: 210,
        priceEvent: 1,
        give: { type: 'buff', buffType:'all', buffValue:0.3, buffDurMs:10*60*1000 }
      },
      {
        id: 'buff_res_10m',
        icon: 'ğŸª',
        name: 'ìì› ì±„êµ´ +80% (10ë¶„)',
        desc: 'ìì›ë§Œ ê°•í•˜ê²Œ ëŠ˜ë¦¬ê³  ì‹¶ì„ ë•Œ.',
        priceCoin: 160,
        priceEvent: 0,
        give: { type: 'buff', buffType:'res', buffValue:0.8, buffDurMs:10*60*1000 }
      },
      {
        id: 'buff_coin_15m',
        icon: 'ğŸ’°',
        name: 'ì½”ì¸ +100% (15ë¶„)',
        desc: 'ì½”ì¸ 2ë°°. ì´ë²¤íŠ¸ ì „ ë°€ì–´ë„£ê¸°.',
        priceCoin: 280,
        priceEvent: 1,
        give: { type: 'buff', buffType:'coin', buffValue:1.0, buffDurMs:15*60*1000 }
      }
    ],
    packs: [
      {
        id: 'res_pack_1500',
        icon: 'ğŸ“¦',
        name: 'ìì› 1,500íŒ©',
        desc: 'ë°”ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ê³  ì‹¶ì„ ë•Œ.',
        priceCoin: 140,
        priceEvent: 0,
        give: { type: 'res', amount: 1500 }
      },
      {
        id: 'coin_pack_200',
        icon: 'ğŸŸ¡',
        name: 'ì½”ì¸ 200íŒ©',
        desc: 'ì½”ì¸ì´ ëª¨ìë„ ë•Œ í•œë²ˆì— ë³´ì¶©.',
        priceCoin: 0,
        priceEvent: 4,
        give: { type: 'coin', amount: 200 }
      }
    ],
    misc: [
      {
        id: 'name_ticket',
        icon: 'ğŸ“',
        name: 'ì´ë¦„ ë³€ê²½ê¶Œ',
        desc: 'ê³„ì • ì´ë¦„/í‘œì‹œì´ë¦„ì„ í•œ ë²ˆ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¶€ëª¨ì—ì„œ ì²˜ë¦¬)',
        priceCoin: 90,
        priceEvent: 0,
        give: { type: 'ticket', ticketType:'rename' }
      },
      {
        id: 'slot_ticket',
        icon: 'ğŸ°',
        name: 'ìŠ¬ë¡¯ ì¶”ê°€ê¶Œ',
        desc: 'ì˜¤ëŠ˜ ìŠ¬ë¡¯ 1íšŒ ë”.',
        priceCoin: 80,
        priceEvent: 0,
        give: { type: 'ticket', ticketType:'slot_add' }
      }
    ]
  };

  // í˜„ì¬ ì”ì•¡ (ë¶€ëª¨ê°€ ì•ˆ ë³´ë‚´ì£¼ë©´ 0)
  let currentCoins = 0;
  let currentEcoins = 0;
  let parentAvailable = false;

  // ===============================
  // ë Œë”
  // ===============================
  const mainArea = document.getElementById('main-area');

  function renderTab(tabName){
    mainArea.innerHTML = '';
    const items = SHOP_ITEMS[tabName] || [];
    const title = document.createElement('div');
    title.className = 'section-title';
    title.innerHTML = `<span>${tabName === 'featured' ? 'ì¶”ì²œ ìƒí’ˆ' :
                       tabName === 'buffs' ? 'ë²„í”„ ìƒí’ˆ' :
                       tabName === 'packs' ? 'ìì›íŒ©' : 'ê¸°íƒ€'}</span>
                       <small>í´ë¦­í•˜ë©´ êµ¬ë§¤ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.</small>`;
    mainArea.appendChild(title);

    items.forEach(item=>{
      const el = document.createElement('div');
      el.className = 'item';
      el.innerHTML = `
        <div class="item-top">
          <div class="item-icon">${item.icon}</div>
          <div>
            <div class="item-name">${item.name}</div>
            <div class="item-desc">${item.desc}</div>
          </div>
        </div>
        <div class="price-row">
          ${item.priceCoin > 0 ? `<div class="price">ğŸŸ¡ <span>${item.priceCoin}</span></div>` : ''}
          ${item.priceEvent > 0 ? `<div class="price">ğŸŸï¸ <span>${item.priceEvent}</span></div>` : ''}
        </div>
        <button class="btn-buy" data-id="${item.id}">êµ¬ë§¤</button>
      `;
      const btn = el.querySelector('.btn-buy');
      btn.addEventListener('click', ()=>handleBuy(item));
      mainArea.appendChild(el);
    });
  }

  // ===============================
  // íƒ­ í´ë¦­
  // ===============================
  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      renderTab(btn.dataset.tab);
    });
  });

  // ì²˜ìŒì€ ì¶”ì²œ
  renderTab('featured');

  // ===============================
  // ë¶€ëª¨ì™€ í†µì‹ 
  // ===============================
  function requestStateToParent(){
    try {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type:'shop:request-state' }, '*');
        parentAvailable = true;
      }
    } catch (e) {
      parentAvailable = false;
    }
  }

  // ë¶€ëª¨ê°€ ìƒíƒœ ë³´ë‚´ì¤„ ë•Œ ì²˜ë¦¬
  window.addEventListener('message', (e)=>{
    const data = e.data;
    if (!data || typeof data !== 'object') return;

    // ë¶€ëª¨ê°€ "ì§€ê¸ˆ ë„¤ê°€ ê°€ì§„ ê±°" ì•Œë ¤ì¤Œ
    if (data.type === 'shop:state') {
      if (typeof data.coins === 'number') {
        currentCoins = data.coins;
        document.getElementById('coins-amount').textContent = data.coins.toLocaleString('ko-KR');
      }
      if (typeof data.eventCoins === 'number') {
        currentEcoins = data.eventCoins;
        document.getElementById('ecoins-amount').textContent = data.eventCoins.toLocaleString('ko-KR');
      }
    }

    // ë¶€ëª¨ê°€ êµ¬ë§¤ ê²°ê³¼ ë³´ë‚´ì¤Œ
    if (data.type === 'shop:result') {
      showToast(data.message || (data.ok ? 'êµ¬ë§¤ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'êµ¬ë§¤ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
      if (data.ok && typeof data.newCoins === 'number') {
        currentCoins = data.newCoins;
        document.getElementById('coins-amount').textContent = data.newCoins.toLocaleString('ko-KR');
      }
      if (data.ok && typeof data.newEventCoins === 'number') {
        currentEcoins = data.newEventCoins;
        document.getElementById('ecoins-amount').textContent = data.newEventCoins.toLocaleString('ko-KR');
      }
    }
  });

  // í˜ì´ì§€ ì—´ë¦¬ë©´ ë¶€ëª¨í•œí…Œ â€œìƒíƒœ ì¤˜â€ ìš”ì²­
  requestStateToParent();

  // ===============================
  // êµ¬ë§¤ ì²˜ë¦¬
  // ===============================
  function handleBuy(item){
    // ë¶€ëª¨ê°€ ìˆìœ¼ë©´ ë¶€ëª¨í•œí…Œ ë§¡ê¹€
    if (parentAvailable) {
      try {
        window.parent.postMessage({
          type: 'shop:buy',
          itemId: item.id,
          priceCoin: item.priceCoin,
          priceEvent: item.priceEvent,
          give: item.give
        }, '*');
        showToast('êµ¬ë§¤ ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.');
        return;
      } catch (e) {
        // ì•„ë˜ ë¡œì»¬ ì²˜ë¦¬ë¡œ ê°ˆê²Œ
      }
    }

    // ë¶€ëª¨ê°€ ì—†ì„ ë•Œ(ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ): ê·¸ëƒ¥ ì”ì•¡ë§Œ ì²´í¬í•´ì„œ í™”ë©´ë§Œ ê°±ì‹ 
    if (item.priceCoin > 0 && currentCoins < item.priceCoin) {
      showToast('ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      return;
    }
    if (item.priceEvent > 0 && currentEcoins < item.priceEvent) {
      showToast('ì´ë²¤íŠ¸ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      return;
    }
    currentCoins  -= item.priceCoin || 0;
    currentEcoins -= item.priceEvent || 0;
    document.getElementById('coins-amount').textContent = currentCoins.toLocaleString('ko-KR');
    document.getElementById('ecoins-amount').textContent = currentEcoins.toLocaleString('ko-KR');
    showToast('êµ¬ë§¤ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¯¸ë¦¬ë³´ê¸°)');
  }

  // ===============================
  // í† ìŠ¤íŠ¸
  // ===============================
  const toastEl = document.getElementById('toast');
  let toastTimer = null;
  function showToast(msg){
    toastEl.textContent = msg;
    toastEl.style.display = 'block';
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>{ toastEl.style.display = 'none'; }, 3000);
  }
  </script>
</body>
</html>
