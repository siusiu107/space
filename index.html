<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ğŸŒŒ íƒœì–‘ê³„ ì •ë³µ: ìš°ì£¼ ìƒì¡´ í´ë¦­ì»¤ ğŸŒŒ</title>
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    body { margin:0; padding:0; font-family:Arial,sans-serif; background:url('images/space-bg.jpg') center/cover no-repeat; color:#fff; }
    img { display:block; }
    #top-bar, #container { visibility: hidden; }
    #auth-container { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.8); padding:20px; border-radius:8px; width:280px; text-align:center; z-index:1000; }
    #auth-container input { width:90%; padding:8px; margin:6px 0; border-radius:4px; border:none; }
    #auth-container button { width:95%; padding:10px; margin:6px 0; background:#00aaff; border:none; border-radius:4px; cursor:pointer; color:#fff; }
    #logout-btn { display:none; position:fixed; bottom:20px; right:10px; background:#f44; color:#fff; border:none; padding:8px 12px; border-radius:4px; cursor:pointer; z-index:1001; }
    #top-bar { position: fixed; top: 5px; left: 5px; right: 5px; display: flex; justify-content: space-between; align-items: center; background: rgba(30, 30, 30, 0.85); padding: 6px 10px; border-radius: 8px; font-size: 12px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
    .bar-group { display: flex; align-items: center; }
    .bar-group img { width: 16px; height: 16px; margin-right: 4px; }
    .bar-group span { margin-right: 12px; white-space: nowrap; }
    .bar-group button { font-size: 12px; padding: 4px 8px; background: #00aaff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    #container { margin: 50px auto 20px; width: 90%; max-width: 600px; padding: 20px; background: rgba(30, 30, 30, 0.9); border-radius: 10px; box-shadow: 0 8px 20px rgba(0,0,0,0.7); text-align: center; position: relative; z-index: 500; }
    h1 { font-size: 1.6em; margin-bottom: 14px; color: #00d4ff; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
    button.general { width: calc(100% - 32px); max-width: 280px; padding: 10px; margin: 6px auto; font-size: 13px; background: url('images/button-bg.png') center/contain no-repeat; color: #fff; border: none; border-radius: 6px; cursor: pointer; transition: opacity 0.2s; }
    button.general:hover { opacity: 0.85; }
    #reset-button { background: rgba(255, 92, 92, 0.9) !important; }
    nav { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 14px; }
    .tab { flex: 1 1 45%; margin: 4px; padding: 8px; background: rgba(51, 51, 51, 0.85); text-align: center; font-size: 13px; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
    .tab.active { background: #00aaff; }
    .tab-content { display: none; margin-top: 12px; font-size: 14px; position: relative; }
    .tab-content.active { display: block; }
    .particle { position: absolute; width: 6px; height: 6px; background: #ffd700; border-radius: 50%; pointer-events: none; opacity: 0.8; animation: floatUp 0.8s ease-out forwards; }
    @keyframes floatUp { to { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; } }
    #ore { width: 200px; cursor: pointer; user-select: none; margin: 20px auto; }
    @media (max-width: 480px) { #top-bar { flex-direction: column; font-size: 11px; } nav { margin-bottom: 10px; } h1 { font-size: 1.4em; } button.general { padding: 8px; font-size: 12px; } #container { margin: 70px auto 20px; padding: 16px; } #ore { width: 140px; } }
  </style>
</head>
<body>
  <div id="auth-container">
    <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
    <input type="email" id="email" placeholder="ì´ë©”ì¼" />
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <button id="login-btn">ë¡œê·¸ì¸</button>
    <button id="signup-btn">íšŒì›ê°€ì…</button>
    <p id="auth-error" style="color:#f66;"></p>
  </div>
  <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>

  <div id="top-bar">
    <div class="bar-group">
      <img src="images/resource-icon.png" alt="Resource" />
      <span id="score">ìì›: 0</span>
      <img src="images/coin-icon.png" alt="Coin" />
      <span id="coins">ì½”ì¸: 0</span>
    </div>
    <div class="bar-group">
      <img id="ship-img" src="images/ship-level1.png" alt="Ship" />
      <span id="ship-level">1ë ™ (20ì½”ì¸)</span>
      <button id="upgrade-ship">ì—…ê·¸ë ˆì´ë“œ</button>
    </div>
  </div>

  <div id="container">
    <h1>ğŸŒŒ íƒœì–‘ê³„ ì •ë³µ: ìš°ì£¼ ìƒì¡´ í´ë¦­ì»¤ ğŸŒŒ</h1>
    <nav>
      <div class="tab active" data-tab="main">ë©”ì¸</div>
      <div class="tab" data-tab="workers">ìš°ì£¼ì¸ ì•Œë°”</div>
      <div class="tab" data-tab="upgrades">í´ë¦­ë‹¹ ì—…ê·¸ë ˆì´ë“œ</div>
      <div class="tab" data-tab="planets">í–‰ì„± êµ¬ë§¤</div>
      <div class="tab" data-tab="reset">ì´ˆê¸°í™”</div>
    </nav>

    <div id="main-content" class="tab-content active">
      <img src="images/ore.png" id="ore" alt="ê´‘ì„" title="í´ë¦­í•´ì„œ ìì› ìˆ˜ì§‘!" />
      <div style="display:flex; justify-content:center; gap:8px; align-items:center;">
        <button id="convert-button" class="general" style="flex:1;">10ìì› â†’ 1ì½”ì¸</button>
        <button id="auto-convert-buy" class="general" style="width:100px; font-size:12px; padding:6px;">ìë™ë³€í™˜ êµ¬ë§¤<br>(100ì½”ì¸)</button>
      </div>
    </div>

    <div id="workers-content" class="tab-content">
      <p>ì´ ì´ˆë‹¹ ìì›: <span id="resource-per-sec">0</span></p>
      <button id="hire-worker" class="general">ì•Œë°” ê³ ìš© (<span id="worker-cost">0</span>ì½”ì¸)</button>
      <div id="worker-list"></div>
      <p>ì´ ì´ˆë‹¹ ì½”ì¸: <span id="coin-per-sec">0</span></p>
      <button id="hire-conversion" class="general">ì½”ì¸ ì•Œë°” (<span id="conversion-cost">0</span>ì½”ì¸)</button>
      <div id="conversion-list"></div>
    </div>

    <div id="upgrades-content" class="tab-content">
      <p>í´ë¦­ë‹¹ ìì›: <span id="click-power">1</span></p>
      <button id="click-upgrade" class="general">í´ë¦­ ì—…ê·¸ë ˆì´ë“œ (15ì½”ì¸)</button>
    </div>

    <div id="planets-content" class="tab-content">
      <div id="planet-list"></div>
    </div>

    <div id="reset-content" class="tab-content">
      <button id="reset-button" class="general">ì´ˆê¸°í™”</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAIrsnUYEBG3cqbPrKD_eejOdtsCDjYG9k",
      authDomain: "siu-studio.firebaseapp.com",
      databaseURL: "https://siu-studio-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "siu-studio",
      storageBucket: "siu-studio.firebasestorage.app",
      messagingSenderId: "830887143444",
      appId: "1:830887143444:web:70b45fc12140e893c31f01",
      measurementId: "G-1Y090YJDB6"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const authContainer = document.getElementById('auth-container');
    const loginBtn = document.getElementById('login-btn');
    const signupBtn = document.getElementById('signup-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const emailInput = document.getElementById('email');
    const pwdInput = document.getElementById('password');
    const authError = document.getElementById('auth-error');
    const topBar = document.getElementById('top-bar');
    const container = document.getElementById('container');

    let uid;
    const defaultData = { resources:0, coins:0, clickPower:1, shipLevel:1, shipUpgradeCost:20, workerCount:0, conversionCount:0, ownedPlanets:[], autoConvertBought:false };
    let state = { ...defaultData };

    const initialWorkerCost=10, workerCostGrowth=1.15;
    const initialWorkerPower=1, workerPowerGrowth=1.05;
    const initialConversionCost=50, conversionCostGrowth=1.3, conversionPower=1;

    function getWorkerCost() { return Math.floor(initialWorkerCost * Math.pow(workerCostGrowth, state.workerCount)); }
    function getWorkerPower() { return initialWorkerPower * Math.pow(workerPowerGrowth, state.workerCount); }
    function getConversionCost() { return Math.floor(initialConversionCost * Math.pow(conversionCostGrowth, state.conversionCount)); }

    onAuthStateChanged(auth, user => {
      if (user) {
        uid = user.uid;
        authContainer.style.display = 'none';
        logoutBtn.style.display = 'block';
        topBar.style.visibility = 'visible'; container.style.visibility = 'visible';
        const dataRef = ref(db, `users/${uid}/gameData`);
        onValue(dataRef, snap => {
          if (snap.exists()) state = { ...defaultData, ...snap.val() };
          else set(dataRef, defaultData);
          updateUI(); renderPlanets();
        });
      } else {
        authContainer.style.display = 'block'; logoutBtn.style.display = 'none';
        topBar.style.visibility = 'hidden'; container.style.visibility = 'hidden';
      }
    });

    loginBtn.addEventListener('click', () =>
      signInWithEmailAndPassword(auth, emailInput.value, pwdInput.value).catch(e=>authError.innerText=e.message)
    );
    signupBtn.addEventListener('click', () =>
      createUserWithEmailAndPassword(auth, emailInput.value, pwdInput.value).catch(e=>authError.innerText=e.message)
    );
    logoutBtn.addEventListener('click', () => signOut(auth));

    function save() { set(ref(db, `users/${uid}/gameData`), state); }

    function updateUI() {
      document.getElementById('score').innerText = `ìì›: ${Math.floor(state.resources)}`;
      document.getElementById('coins').innerText = `ì½”ì¸: ${Math.floor(state.coins)}`;
      document.getElementById('ship-level').innerText = `${state.shipLevel}ë ™ (${state.shipUpgradeCost}ì½”ì¸)`;
      document.getElementById('ship-img').src = `images/ship-level${state.shipLevel}.png`;
      document.getElementById('click-power').innerText = state.clickPower;
      document.getElementById('resource-per-sec').innerText = (state.workerCount * getWorkerPower()).toFixed(1);
      document.getElementById('coin-per-sec').innerText = (state.conversionCount * conversionPower).toFixed(1);
      document.getElementById('worker-cost').innerText = getWorkerCost();
      document.getElementById('conversion-cost').innerText = getConversionCost();
      document.getElementById('hire-worker').innerText = `ì•Œë°” ê³ ìš© (${getWorkerCost()}ì½”ì¸)`;
      document.getElementById('hire-conversion').innerText = `ì½”ì¸ ì•Œë°” (${getConversionCost()}ì½”ì¸)`;
      document.getElementById('auto-convert-buy').disabled = state.autoConvertBought || state.coins < 100;
    }

    function renderPlanets() {
      const list = document.getElementById('planet-list');
      list.innerHTML = state.ownedPlanets.map(i=>"").join(''); // clear
      planets.forEach((p,i)=>{
        const owned = state.ownedPlanets.includes(i);
        const canBuy = state.shipLevel>=p.requiredShipLevel;
        const div = document.createElement('div');
        div.style.margin='8px 0'; div.innerHTML = `<strong>${p.name}</strong> â€” ${p.cost.toLocaleString()}ì½”ì¸<br>í•„ìš” ë ™: ${p.requiredShipLevel}`;
        const btn = document.createElement('button');
        btn.textContent = owned? 'êµ¬ë§¤ ì™„ë£Œ' : canBuy? 'êµ¬ë§¤' : 'ë ˆë²¨ ë¶€ì¡±';
        btn.disabled = owned || !canBuy;
        btn.addEventListener('click', () => {
          if (state.coins>=p.cost) { state.coins -= p.cost; state.ownedPlanets.push(i); save(); }
          else alert('ì½”ì¸ ë¶€ì¡±!');
        });
        div.appendChild(document.createElement('br'));
        div.appendChild(btn);
        list.appendChild(div);
      });
    }

    window.onload = () => {
      const ore = document.getElementById('ore');
      ore.addEventListener('click', e => {
        for (let i=0;i<15;i++){ /* particle code omitted for brevity */ }
        state.resources += state.clickPower;
        save(); updateUI();
      });

      document.getElementById('convert-button').addEventListener('click', () => {
        if (state.resources>=10) { state.resources -=10; state.coins++; save(); updateUI(); }
        else alert('ìì› ë¶€ì¡±!');
      });

      document.getElementById('auto-convert-buy').addEventListener('click', () => {
        if (state.coins>=100 && !state.autoConvertBought) {
          state.coins -=100; state.autoConvertBought = true; save(); updateUI();
        }
      });

      document.getElementById('upgrade-ship').addEventListener('click', () => {
        if (state.coins>=state.shipUpgradeCost) {
          state.coins -= state.shipUpgradeCost;
          state.shipLevel++; state.shipUpgradeCost = Math.floor(state.shipUpgradeCost*2+30);
          save(); updateUI();
        } else alert('ì½”ì¸ ë¶€ì¡±!');
      });

      // other buttons: click-upgrade, hire-worker, hire-conversion ...
      // interval auto income & auto-convert
      setInterval(()=>{
        if(state.workerCount>0) state.resources += state.workerCount*getWorkerPower();
        if(state.conversionCount>0) state.coins += state.conversionCount*conversionPower;
        if(state.autoConvertBought) {
          while(state.resources>=10) { state.resources-=10; state.coins++; }
        }
        save(); updateUI();
      },1000);

      document.getElementById('reset-button').addEventListener('click', ()=>{
        if(confirm('ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
          state = { ...defaultData }; save(); updateUI(); renderPlanets();
        }
      });

      document.querySelectorAll('.tab').forEach(tab=> tab.addEventListener('click', ()=>{
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        document.querySelector(`#${tab.dataset.tab}-content`).classList.add('active');
        document.querySelectorAll('.tab').forEach(tb=>tb.classList.remove('active'));
        tab.classList.add('active');
      }));
    };

    const planets = [
      {name:'ë‹¬', cost:100, requiredShipLevel:1},
      {name:'ìˆ˜ì„±', cost:500, requiredShipLevel:2},
      {name:'ê¸ˆì„±', cost:2000, requiredShipLevel:3},
      {name:'ì§€êµ¬', cost:10000, requiredShipLevel:4},
      {name:'í™”ì„±', cost:50000, requiredShipLevel:5},
      {name:'ëª©ì„±', cost:250000, requiredShipLevel:6},
      {name:'í† ì„±', cost:1000000, requiredShipLevel:7},
      {name:'ì²œì™•ì„±', cost:5000000, requiredShipLevel:8},
      {name:'í•´ì™•ì„±', cost:20000000, requiredShipLevel:9}
    ];
  </script>
</body>
</html>
