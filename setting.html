<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>âš™ï¸ ì„¤ì • - íƒœì–‘ê³„ ì •ë³µ</title>
  <style>
    :root{
      --glass-bg: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(6,7,12,0.55));
      --stroke: rgba(255,255,255,0.12);
      --muted: #bcd8ee;
      --accent: #00c0ff;
      --accent-2:#00a2ff;
      --danger:#ff6b6b;
    }
    *{ box-sizing: border-box; }
    body{
      margin:0; padding:0; font-family: Inter, Arial, sans-serif;
      background:#0b1220 url('/images/space-bg.jpg') center/cover no-repeat fixed;
      color:#e6f7ff;
    }
    a{ color:inherit; text-decoration:none; }

    /* ìƒë‹¨ë°” */
    #topbar{
      position:fixed; top:8px; left:8px; right:8px; z-index: 1000;
      display:flex; align-items:center; justify-content:space-between;
      padding:8px 10px; border-radius:12px;
      background: rgba(20,24,34,0.75);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border:1px solid var(--stroke);
    }
    #back-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:10px; cursor:pointer;
      background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border:1px solid var(--stroke); font-weight:800;
    }
    #back-btn:hover{ filter:brightness(1.05); }
    #addr{ font-size:12px; color: var(--muted); user-select:none; }

    /* ì»¨í…Œì´ë„ˆ */
    #container{ width: min(980px, 94vw); margin: 70px auto 28px; display:grid; gap:16px; }
    .card{
      background: var(--glass-bg); border: 1px solid var(--stroke);
      border-radius: 16px; box-shadow: 0 16px 40px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.06);
      padding:16px;
    }
    h1{ margin:0 0 8px; font-size:22px; color:#dff7ff; }
    .sub{ margin:0 0 18px; font-size:13px; color:var(--muted); }

    /* ì„¤ì • ì•„ì´í…œ */
    .item{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:12px; border-radius:12px;
      border:1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      margin:10px 0;
    }
    .item .left{ display:flex; align-items:center; gap:10px; }
    .item .title{ font-weight:800; }
    .item .desc{ font-size:12px; color:var(--muted); }
    .item .right{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .item .right .status-text{ font-size:12px; color:var(--muted); }

    /* ë²„íŠ¼ */
    .btn{
      padding:10px 12px; border:1px solid var(--stroke);
      color:#001218; font-weight:800; border-radius:10px; cursor:pointer;
      background-image: linear-gradient(180deg, var(--accent), var(--accent-2));
    }
    .btn.secondary{
      color:#e6f7ff; background-image:none;
      background:linear-gradient(180deg, rgba(255,255,255,0.09), rgba(255,255,255,0.03));
    }
    .btn.danger{
      background-image:none; color:#ffecec;
      background: linear-gradient(180deg, rgba(255,50,50,0.9), rgba(200,0,0,0.88));
      border-color: rgba(255,80,80,0.4);
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    /* êµ¬ë¶„ì„  */
    .hr{ height:1px; background: rgba(255,255,255,0.08); margin: 10px 0; }

    /* í† ìŠ¤íŠ¸ */
    #toast{
      position:fixed; left:50%; bottom: max(18px, env(safe-area-inset-bottom));
      transform: translateX(-50%) translateY(20px);
      background: rgba(0,0,0,0.75); color:#fff;
      padding:10px 14px; border-radius:10px; opacity:0; pointer-events:none;
      transition:all .25s ease; z-index:2000;
      border:1px solid rgba(255,255,255,0.12);
    }
    #toast.show{ opacity:1; transform: translateX(-50%) translateY(0); }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #overlay{
      position: fixed; inset:0; display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.45); z-index: 1800;
    }
    #overlay .box{
      width:300px; border-radius:14px; padding:16px; text-align:center;
      background: var(--glass-bg); border:1px solid var(--stroke); color:#dff7ff;
    }
    .spinner{
      width:42px; height:42px; border-radius:50%;
      border:4px solid rgba(255,255,255,0.18); border-top-color: var(--accent);
      margin: 10px auto; animation: spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* í‘¸í„° (ê¸°ë³¸) */
    footer{ margin:12px 0 24px; text-align:center; color:var(--muted); font-size:12px; }

    /* ì„¹ì…˜ í† ê¸€ */
    #user-section, #admin-section{ display:none; } /* admin-section ìš”ì†ŒëŠ” ì œê±°ë˜ì—ˆì§€ë§Œ ì›ë˜ ìŠ¤íƒ€ì¼ì€ ìœ ì§€ */

    /* --- footer & small button & policy modal (ADD) --- */
    footer{
      display:flex; gap:10px; align-items:center; justify-content:center;
      flex-wrap:wrap;
    }
    footer .copy{ opacity:.9; }
    .btn.tiny{ padding:6px 8px; font-size:12px; border-radius:8px; }

    #policy{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:2100;
      background: rgba(0,0,0,0.5);
    }
    #policy .panel{
      width:min(860px, 94vw); max-height:86vh; overflow:hidden;
      background: var(--glass-bg); border:1px solid var(--stroke);
      border-radius:16px; padding:12px;
    }
    #policy .panel .head{
      display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px;
    }
    #policy iframe{
      width:100%; height:70vh; border:1px solid var(--stroke);
      border-radius:12px; background:#000;
    }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ë°” -->
  <div id="topbar">
    <button id="back-btn" aria-label="ëŒì•„ê°€ê¸°">â¬…ï¸ ëŒì•„ê°€ê¸°</button>
    <div id="addr">/setting</div>
  </div>

  <div id="container">
    <!-- ===== ì‚¬ìš©ì ì„¹ì…˜ ===== -->
    <div id="user-section" class="card">
      <h1>âš™ï¸ ì„¤ì •</h1>
      <p class="sub">ì‹¤ì œë¡œ ì œê³µë˜ëŠ” ì„¤ì •ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.</p>

      <!-- ì–¸ì–´ -->
      <div class="item">
        <div class="left">
          <div>ğŸŒ</div>
          <div>
            <div class="title">ì–¸ì–´</div>
            <div class="desc">í‘œì‹œ ì–¸ì–´ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì›í•˜ëŠ” ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
          </div>
        </div>
        <div class="right">
          <div class="gtranslate_wrapper" aria-label="ì–¸ì–´ ì„ íƒ ë„êµ¬"></div>
          <div id="language-status" class="status-text">í˜„ì¬ ì–¸ì–´: í•œêµ­ì–´</div>
        </div>
      </div>

      <!-- ê³„ì • -->
      <div class="item">
        <div class="left">
          <div>ğŸ‘¤</div>
          <div>
            <div class="title">ê³„ì •</div>
            <div class="desc" id="account-desc">ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘â€¦</div>
            <!-- ì €ì¥ ê²½ë¡œ ë…¸ì¶œ ì œê±°: account-path í–‰ ì‚­ì œ -->
          </div>
        </div>
        <div class="right">
          <button id="signout-btn" class="btn secondary" disabled>ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <div class="hr"></div>

      <!-- ë°ì´í„°(ì „ì²´ ì‚­ì œ) -->
      <div class="item">
        <div class="left">
          <div>â™»ï¸</div>
          <div>
            <div class="title">ê²Œì„ ë°ì´í„° ì´ˆê¸°í™”</div>
            <div class="desc">ì´ ê³„ì •ì˜ ê²Œì„ ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•œ ë’¤ ìë™ ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤.</div>
          </div>
        </div>
        <div class="right">
          <button id="reset-btn" class="btn danger" disabled>ì „ì²´ ì‚­ì œ</button>
        </div>
      </div>
    </div>

    <footer>
      <span>íƒœì–‘ê³„ ì •ë³µ: ìš°ì£¼ ìƒì¡´ í´ë¦­ì»¤ Â· v0.1.0</span>
      <span class="copy">â“’ 2025. siustudio All rights reserved.</span>
      <button id="btn-policy" class="btn secondary tiny" aria-haspopup="dialog" aria-controls="policy">ì´ìš©ì•½ê´€</button>
      <button id="btn-privacy" class="btn secondary tiny" aria-haspopup="dialog" aria-controls="policy">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</button>
    </footer>
  </div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast" role="status" aria-live="polite">ì•Œë¦¼</div>

  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="overlay" aria-hidden="true">
    <div class="box">
      <div>ì²˜ë¦¬ ì¤‘â€¦</div>
      <div class="spinner" aria-hidden="true"></div>
      <div style="font-size:12px;color:#cfe7ff;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
    </div>
  </div>

  <!-- ì‚¬ì´íŠ¸ ì´ìš©ì•½ê´€/ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ -->
  <div id="policy" aria-modal="true" role="dialog">
    <div class="panel">
      <div class="head">
        <h3 id="policy-title" style="margin:0">ì´ìš©ì•½ê´€</h3>
        <div style="display:flex; gap:6px">
          <a id="policy-newtab" href="/terms" target="_blank" rel="noopener" class="btn secondary tiny" title="ìƒˆ íƒ­ì—ì„œ ì—´ê¸°">ìƒˆ íƒ­</a>
          <button id="policy-close" class="btn secondary tiny">ë‹«ê¸°</button>
        </div>
      </div>
      <iframe id="policy-iframe" src="/terms" title="ì´ìš©ì•½ê´€" loading="lazy"></iframe>
      <p class="muted" style="font-size:12px;margin-top:8px">ë™ì¼ ë„ë©”ì¸ ì •ì±…ì— ë”°ë¼ ë¬¸ì„œê°€ í”„ë ˆì„ ë‚´ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <script src="language.js"></script>
  <script src="https://cdn.gtranslate.net/widgets/latest/popup.js" defer></script>

  <!-- Firebase + App Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import {
      getDatabase, ref, runTransaction, push, onChildAdded, set, remove,
      serverTimestamp, update, get, child
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    /* ì£¼ì†Œ í‘œì‹œ ê³ ì • */
    try { history.replaceState(null, '', '/setting' + (location.hash || '')); } catch (e) {}

    /* Firebase ì„¤ì • */
    const firebaseConfig = {
      apiKey: "AIzaSyAIrsnUYEBG3cqbPrKD_eejOdtsCDjYG9k",
      authDomain: "siu-studio.firebaseapp.com",
      databaseURL: "https://siu-studio-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "siu-studio",
      storageBucket: "siu-studio.appspot.com",
      messagingSenderId: "830887143444",
      appId: "1:830887143444:web:70b45fc12140e893c31f01",
      measurementId: "G-1Y090YJDB6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    /* ê³µí†µ UI */
    const backBtn     = document.getElementById('back-btn');
    const toast       = document.getElementById('toast');
    const overlay     = document.getElementById('overlay');

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove('show'), 1600);
    }
    function showOverlay(show){
      overlay.style.display = show ? 'flex' : 'none';
      overlay.setAttribute('aria-hidden', show ? 'false':'true');
    }
    backBtn.addEventListener('click', () => { location.href = '/game.html'; });

    /* ì‚¬ìš©ì ì„¹ì…˜ refs */
    const userSection  = document.getElementById('user-section');
    const accountDesc = document.getElementById('account-desc');
    const signoutBtn  = document.getElementById('signout-btn');
    const resetBtn    = document.getElementById('reset-btn');
    const languageStatus = document.getElementById('language-status');

    const languageManager = window.LanguageSync;
    const languageNames = { ko: 'í•œêµ­ì–´', en: 'English', es: 'EspaÃ±ol' };

    function updateLanguageStatus(lang){
      if(!languageStatus) return;
      const name = languageNames[lang] || lang?.toUpperCase() || 'í•œêµ­ì–´';
      languageStatus.textContent = `í˜„ì¬ ì–¸ì–´: ${name}`;
    }

    updateLanguageStatus(languageManager?.getCurrentLanguage?.() || 'ko');
    window.addEventListener('preferredLanguageChange', (event)=>{
      const lang = event.detail?.lang;
      if(lang) updateLanguageStatus(lang);
    });

    function persistLanguage(lang){
      if(!lang) return;
      languageManager?.setLanguage?.(lang);
    }

    let lastLang = languageManager?.getCurrentLanguage?.() || null;
    setInterval(()=>{
      let current = null;
      try{
        if (typeof window.GTranslateGetCurrentLang === 'function'){
          current = window.GTranslateGetCurrentLang() || null;
        }
      }catch{}
      if(!current) current = languageManager?.getCurrentLanguage?.();
      if(current && current !== lastLang){
        lastLang = current;
        persistLanguage(current);
      }
    }, 1000);

    /* ===== ìƒ¤ë”©/ì•„ì´ë””í‚¤ ìœ í‹¸ ===== */
    let uid = null;
    let userServerKey = null; // "server1" ë“±
    let userIdKey     = null; // ì •ê·œí™”ëœ ì´ë©”ì¼ ë¡œì»¬íŒŒíŠ¸
    let userBasePath  = null; // `users/${server}/${id}` (ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©, í™”ë©´ ë…¸ì¶œ ê¸ˆì§€)

    function sanitizeIdKey(raw) {
      const s = (raw || '').toString().trim().toLowerCase();
      const base = s.replace(/[^a-z0-9._-]+/g, '_').replace(/^_+|_+$/g, '');
      return base || 'user';
    }
    function makeIdKeyFromUser(user) {
      const email = (user.email || '').toString();
      if (email.includes('@')) {
        const local = email.split('@')[0];
        return sanitizeIdKey(local);
      }
      const name = sanitizeIdKey(user.displayName || '');
      if (name && name !== 'user') return name;
      return `user_${(user.uid || '').slice(0,6) || '000000'}`;
    }

    async function ensureServerMapping(user) {
      // ê¸°ì¡´ ë§¤í•‘ í™•ì¸
      const mapRef = ref(db, `userServerMap/${user.uid}`);
      try {
        const snap = await get(mapRef);
        if (snap.exists()) {
          const { server, id } = snap.val() || {};
          if (server && id) return { server, id };
        }
      } catch {}

      // ì‹ ê·œ ë°°ì •: meta/nextIndex íŠ¸ëœì­ì…˜ (15ëª… ë‹¨ìœ„ ì„œë²„)
      let nextIndex = 0;
      try {
        const tRef = ref(db, 'meta/nextIndex');
        const res = await runTransaction(tRef, cur => (cur || 0) + 1);
        nextIndex = res?.snapshot?.val() || 1;
      } catch { nextIndex = 1; }

      const serverNum = Math.max(1, Math.ceil(nextIndex / 15));
      let server = `server${serverNum}`;
      let idKey  = makeIdKeyFromUser(user);

      // ì„œë²„ ë‚´ í‚¤ ì¶©ëŒ ë°©ì§€
      try {
        const existsSnap = await get(ref(db, `users/${server}/${idKey}`));
        if (existsSnap.exists()) idKey = `${idKey}-${(user.uid||'').slice(0,4)}`;
      } catch {}

      // ë§¤í•‘ ì €ì¥
      try {
        await update(ref(db), {
          [`userServerMap/${user.uid}`]: { server, id: idKey, createdAt: Date.now() }
        });
      } catch {}

      return { server, id: idKey };
    }

    async function migrateLegacyIfExists(uid, basePath) {
      try {
        const oldSnap = await get(ref(db, `users/${uid}`));
        if (!oldSnap.exists()) return;
        const old = oldSnap.val() || {};
        const updates = {};
        if (old.gameData) updates[`${basePath}/gameData`] = old.gameData;
        if (old.daily)    updates[`${basePath}/daily`]    = old.daily;
        if (Object.keys(updates).length) {
          updates[`migrations/${uid}`] = { to: basePath, at: Date.now() };
          await update(ref(db), updates);
        }
      } catch {}
    }

    // ì‚¬ìš©ì: ê³„ì •/ì´ˆê¸°í™”
    signoutBtn.addEventListener('click', async () => {
      try { await signOut(auth); showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆì–´ìš”'); setTimeout(()=>location.href='/index.html', 400); }
      catch (e) { console.error(e); showToast('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨'); }
    });

    // â€œì „ì²´ ì‚­ì œ + ìë™ ë¡œê·¸ì•„ì›ƒâ€
    resetBtn.addEventListener('click', async () => {
      if (!uid){ showToast('ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš”'); return; }
      const basePath = userBasePath || `users/${uid}`; // ë‚´ë¶€ ì•ˆì „ì¥ì¹˜
      const ok = confirm(
        `ì •ë§ ì‚­ì œí• ê¹Œìš”?\n` +
        `â€» ê²½ê³ : ì´ ê³„ì •ì˜ ëª¨ë“  ê²Œì„ ë°ì´í„°(ì¶œì„/ì´ë²¤íŠ¸/ì„¤ì • í¬í•¨)ê°€ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤.\n` +
        `ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.`
      );
      if (!ok) return;

      // ë²„íŠ¼ ì¤‘ë³µ í´ë¦­ ë°©ì§€
      resetBtn.disabled = true;
      signoutBtn.disabled = true;
      showOverlay(true);

      try{
        // ìƒˆ êµ¬ì¡° ì „ì²´ ì œê±°
        await remove(ref(db, basePath));

        // ë ˆê±°ì‹œ ê²½ë¡œê°€ ë‚¨ì•„ìˆë‹¤ë©´ ê°™ì´ ì œê±°
        try { await remove(ref(db, `users/${uid}`)); } catch {}

        // ë¡œì»¬ ìºì‹œ ì •ë¦¬
        try { localStorage.removeItem(`lastWrite_${uid}`); } catch {}

        showToast('ì‚¬ìš©ì ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤â€¦');
        // ìë™ ë¡œê·¸ì•„ì›ƒ
        try { await signOut(auth); } catch(e){ console.warn('signOut ì‹¤íŒ¨:', e); }
        // í™ˆìœ¼ë¡œ ì´ë™
        setTimeout(()=>{ location.href = '/index.html'; }, 600);
      }catch(e){
        console.error(e);
        showToast('ì‚­ì œ ì‹¤íŒ¨. ë„¤íŠ¸ì›Œí¬/ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.');
        // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ì›ë³µ
        resetBtn.disabled = false;
        signoutBtn.disabled = false;
      }finally{
        showOverlay(false);
      }
    });

    /* ===== ì¸ì¦ ìƒíƒœ: ì‚¬ìš©ì UI í‘œì‹œ + ë§¤í•‘ í™•ë³´ ===== */
    onAuthStateChanged(auth, async (user) => {
      uid = user ? user.uid : null;

      if (!user) {
        userSection.style.display = 'block';
        accountDesc.textContent = 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
        signoutBtn.disabled = true;
        resetBtn.disabled = true;
        return;
      }

      // ì„œë²„/ì•„ì´ë”” ë§¤í•‘ í™•ë³´ (ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©)
      try {
        const mapping = await ensureServerMapping(user);
        userServerKey = mapping.server;
        userIdKey     = mapping.id;
        userBasePath  = `users/${userServerKey}/${userIdKey}`;

        // ë ˆê±°ì‹œ ë°ì´í„°ê°€ ë‚¨ì•„ìˆë‹¤ë©´ 1íšŒ ì´ê´€
        await migrateLegacyIfExists(uid, userBasePath);
      } catch {
        userBasePath = `users/${uid}`; // ë‚´ë¶€ ì•ˆì „ì¥ì¹˜
      }

      userSection.style.display = 'block';

      if (user && user.emailVerified){
        accountDesc.textContent = `${user.email} (ë¡œê·¸ì¸ë¨)`;
        signoutBtn.disabled = false;
        resetBtn.disabled = false;
      } else if (user && !user.emailVerified){
        accountDesc.textContent = 'ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ì¸ì¦ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
        signoutBtn.disabled = false;
        resetBtn.disabled = true;
      }
    });

    /* --- policy modal open/close --- */
    const btnPolicy   = document.getElementById('btn-policy');
    const btnPrivacy  = document.getElementById('btn-privacy');
    const policyModal = document.getElementById('policy');
    const policyClose = document.getElementById('policy-close');
    const policyTitle = document.getElementById('policy-title');
    const policyIframe = document.getElementById('policy-iframe');
    const policyNewTab = document.getElementById('policy-newtab');

    const policyMap = {
      terms: { title: 'ì´ìš©ì•½ê´€', url: '/terms' },
      privacy: { title: 'ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨', url: '/privacy' }
    };

    function openPolicy(type = 'terms'){
      const { title, url } = policyMap[type] || policyMap.terms;
      if (policyTitle) policyTitle.textContent = title;
      if (policyIframe) {
        policyIframe.src = url;
        policyIframe.title = title;
      }
      if (policyNewTab) {
        policyNewTab.href = url;
        policyNewTab.title = `${title} ìƒˆ íƒ­ì—ì„œ ì—´ê¸°`;
        policyNewTab.setAttribute('aria-label', `${title} ìƒˆ íƒ­ì—ì„œ ì—´ê¸°`);
      }
      if (policyModal) policyModal.style.display = 'flex';
    }
    function closePolicy(){ if (policyModal) policyModal.style.display = 'none'; }

    btnPolicy?.addEventListener('click', () => openPolicy('terms'));
    btnPrivacy?.addEventListener('click', () => openPolicy('privacy'));
    policyClose?.addEventListener('click', closePolicy);
    // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
    policyModal?.addEventListener('click', (e)=>{ if(e.target === policyModal) closePolicy(); });
    // ESC í‚¤ ë‹«ê¸°
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && policyModal.style.display === 'flex') closePolicy(); });
  </script>
</body>
</html>
