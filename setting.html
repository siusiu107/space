<!-- /require-login.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ”’ ë¡œê·¸ì¸ í•„ìš” - íƒœì–‘ê³„ ì •ë³µ</title>
  <script>
    try { history.replaceState(null, '', '/ë¡œê·¸ì¸í•„ìš”' + (location.hash || '')); }
    catch(e){ console.warn('ì£¼ì†Œ í‘œì‹œ ë³€ê²½ ì‹¤íŒ¨:', e); }
  </script>

  <!-- Google Fonts (ì°¸ê³  HTMLê³¼ ë™ì¼ ë¬´ë“œ) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      position: relative;
      font-family: 'Montserrat', sans-serif;
      background: #000;
      overflow: hidden;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color:#fff;
    }
    /* ì€í•˜ìˆ˜ ë°°ê²½ íš¨ê³¼ */
    body::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%; right: -50%; bottom: -50%;
      background: url('images/galaxy-bg.jpg') center/cover no-repeat;
      filter: brightness(0.4) blur(8px);
      animation: rotateBg 60s linear infinite;
      z-index: 0;
    }
    @keyframes rotateBg {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .card {
      position: relative;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 42px 28px;
      max-width: 520px;
      width: 92vw;
      text-align: center;
      color: #fff;
      box-shadow: 0 8px 32px rgba(0,0,0,0.7);
      z-index: 1;
      animation: fadeIn 0.9s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.96);} to { opacity:1; transform: scale(1);} }

    .planet-image {
      width: 110px;
      margin: 0 auto 18px;
      animation: float 4s ease-in-out infinite;
      user-select:none;
    }
    @keyframes float {
      0%,100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-16px) rotate(8deg); }
    }

    h1 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 2.2rem;
      margin-bottom: 12px;
      letter-spacing: 2px;
      background: linear-gradient(90deg, #00d2ff, #3a7bd5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: titleGlow 2s ease-in-out infinite alternate;
    }
    @keyframes titleGlow {
      from { text-shadow: 0 0 10px rgba(0,210,255,0.7); }
      to   { text-shadow: 0 0 22px rgba(58,123,213,0.9); }
    }

    p {
      font-size: 1rem;
      margin-bottom: 26px;
      line-height: 1.6;
      opacity: 0.9;
    }

    .btn-row{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }

    button {
      background: linear-gradient(135deg, #3a7bd5, #00d2ff);
      border: none;
      padding: 14px 22px;
      font-size: 0.95rem;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.25s, box-shadow 0.25s, opacity .2s;
      color: #001218;
      font-weight: 800;
      box-shadow: 0 6px 24px rgba(0,150,255,0.35);
    }
    button:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 10px 30px rgba(0,170,255,0.5); }
    button.secondary{
      background: linear-gradient(135deg, rgba(255,255,255,0.16), rgba(255,255,255,0.06));
      color:#e6f7ff; border:1px solid rgba(255,255,255,0.18); box-shadow:none;
    }
    .hidden { display: none !important; }

    /* í’€ìŠ¤í¬ë¦° ë°°ë„ˆ */
    #banner{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.85); color:#fff; font-size:20px; z-index:99999;
    }
    #banner.show{ display:flex; }
  </style>
</head>
<body>
  <div class="card" id="content">
    <img src="images/planet-icon.png" alt="Planet Icon" class="planet-image" />
    <h1 id="title">ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!</h1>
    <p id="message">ë³´ì•ˆì„ ìœ„í•´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
    <div class="btn-row">
      <button id="go-login">ë¡œê·¸ì¸í•˜ëŸ¬ ê°€ê¸°</button>
      <button id="back-btn" class="secondary">â—€ï¸ ëŒì•„ê°€ê¸°</button>
      <button id="go-game" class="hidden">ê²Œì„ìœ¼ë¡œ ê°€ê¸°</button>
    </div>
  </div>

  <div id="banner" aria-live="polite">ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

    // (ë©”ì¸/ì„¤ì •ê³¼ ë™ì¼ ì„¤ì •)
    const firebaseConfig = {
      apiKey: "AIzaSyAIrsnUYEBG3cqbPrKD_eejOdtsCDjYG9k",
      authDomain: "siu-studio.firebaseapp.com",
      databaseURL: "https://siu-studio-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "siu-studio",
      storageBucket: "siu-studio.appspot.com",
      messagingSenderId: "830887143444",
      appId: "1:830887143444:web:70b45fc12140e893c31f01",
      measurementId: "G-1Y090YJDB6"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const titleEl = document.getElementById('title');
    const msgEl   = document.getElementById('message');
    const goLogin = document.getElementById('go-login');
    const goGame  = document.getElementById('go-game');
    const backBtn = document.getElementById('back-btn');
    const banner  = document.getElementById('banner');

    function getParam(name){
      const m = new URLSearchParams(location.search).get(name);
      return m ? decodeURIComponent(m) : null;
    }

    // next ìš°ì„ ìˆœìœ„: ?next -> document.referrer -> í™ˆ
    function computeNext(){
      const qNext = getParam('next');
      if (qNext) return qNext;
      try{
        if (document.referrer && new URL(document.referrer).origin === location.origin){
          return document.referrer;
        }
      }catch{}
      return location.origin + '/';
    }

    function rememberNext(nextUrl){
      try { sessionStorage.setItem('pending_redirect', nextUrl); } catch {}
    }

    function showBannerAndGo(url, text){
      if (text) banner.textContent = text;
      banner.classList.add('show');
      setTimeout(()=>{ window.location.href = url; }, 900);
    }

    // ë²„íŠ¼: ëŒì•„ê°€ê¸°
    backBtn.addEventListener('click', () => {
      try{
        if (history.length > 1) { history.back(); return; }
      }catch{}
      window.location.href = '/';
    });

    // ë²„íŠ¼: ë¡œê·¸ì¸í•˜ëŸ¬ ê°€ê¸° (ë©”ì¸ ê²Œì„ í˜ì´ì§€ì˜ ë¡œê·¸ì¸ UIë¡œ)
    goLogin.addEventListener('click', () => {
      const next = computeNext();
      rememberNext(next);
      // ë©”ì¸ ê²Œì„ íŒŒì¼ ê²½ë¡œ: í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì • ê°€ëŠ¥ (ì˜ˆ: '/', '/game.html')
      const dest = '/game.html';
      showBannerAndGo(dest, 'ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦');
    });

    // ë²„íŠ¼: ê²Œì„ìœ¼ë¡œ ê°€ê¸° (ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ë…¸ì¶œ)
    goGame.addEventListener('click', () => {
      const next = computeNext();
      // nextê°€ í˜„ì¬ í˜ì´ì§€ë©´ í™ˆìœ¼ë¡œ ëŒ€ì²´
      const go = (next && next !== location.href) ? next : '/game.html';
      window.location.href = go;
    });

    // ì¸ì¦ ìƒíƒœì— ë”°ë¼ UI ë¶„ê¸°
    onAuthStateChanged(auth, user => {
      const next = computeNext();

      if (!user){
        // ë¹„ë¡œê·¸ì¸: ì•ˆë‚´ë¬¸ + next ì €ì¥ + ìë™ ì´ë™ ìœ ë„
        titleEl.textContent = 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!';
        msgEl.textContent   = 'ì ì‹œ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦';
        rememberNext(next);
        // ìë™ ì´ë™(2.2ì´ˆ ë’¤) â€” ì‚¬ìš©ìê°€ ì§ì ‘ ë²„íŠ¼ ëˆ„ë¥´ì§€ ì•Šì•„ë„ ì§„í–‰
        setTimeout(() => {
          // ì‚¬ìš©ìê°€ ì´ë¯¸ ì´ë™í–ˆìœ¼ë©´ ì¤‘ë³µ ì´ë™ ë°©ì§€
          if (document.hidden) return;
          showBannerAndGo('/game.html', 'ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦');
        }, 2200);
        return;
      }

      // ë¡œê·¸ì¸ëœ ìƒíƒœ
      titleEl.textContent = 'ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆì–´ìš” âœ¨';
      msgEl.textContent   = 'ë°”ë¡œ ê²Œì„ìœ¼ë¡œ ì´ë™í•˜ê±°ë‚˜, ëŒì•„ê°ˆ ìˆ˜ ìˆì–´ìš”.';
      goGame.classList.remove('hidden');

      // ì‚´ì§ ëŒ€ê¸° í›„ ìë™ ì´ë™ (ì„ í˜¸ì— ë”°ë¼ ì£¼ì„ ì²˜ë¦¬ ê°€ëŠ¥)
      setTimeout(() => {
        if (document.hidden) return;
        const go = (next && next !== location.href) ? next : '/game.html';
        showBannerAndGo(go, 'ê²Œì„ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦');
      }, 1600);
    });
  </script>

  <!-- ê°œë°œì ë„êµ¬ ì°¨ë‹¨ (ì°¸ê³  HTMLê³¼ ë™ì¼ í†¤) -->
  <script src="https://cdn.jsdelivr.net/npm/disable-devtool@latest"></script>
  <script>
    DisableDevtool({
      disableMenu: true,
      disableSelect: true,
      disableCopy: true,
      disableCut: true,
      disablePaste: true,
      clearIntervalWhenDevOpenTrigger: true,
      ondevtoolopen(type, next) {
        try{ window.close(); }catch{}
        next();
      },
      ondevtoolclose() {
        console.warn('DevTools ë‹«í˜ ê°ì§€ë¨');
      }
    });

    // ìš°í´ë¦­ ì „ì²´ ì°¨ë‹¨ (ì…ë ¥ ìš”ì†ŒëŠ” ì˜ˆì™¸)
    document.addEventListener('contextmenu', function (e) {
      if (e.target.closest('input, textarea, [contenteditable="true"]')) return;
      e.preventDefault();
    });
  </script>
</body>
</html>
