<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>404 • 페이지를 찾을 수 없습니다</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    display:flex;align-items:center;justify-content:center;
    background:#fafafa;font-family:'Raleway',sans-serif;color:#333;
    padding:1rem;
  }
  #notfound {
    width:100%;max-width:420px;padding:2rem;border-radius:10px;
    background:#fff;box-shadow:0 8px 24px rgba(0,0,0,0.08);
    text-align:center;position:relative;overflow:hidden;
    transition:opacity .12s ease, transform .12s ease;
  }
  .icon{font-size:4.5rem;margin-bottom:0.4rem;display:inline-block;animation:shake 1.6s infinite ease-in-out;}
  @keyframes shake{0%,100%{transform:rotate(0)}25%{transform:rotate(6deg)}75%{transform:rotate(-6deg)}}
  h1{font-family:'Fredoka One',cursive;font-size:4.8rem;color:#2d9cdb;margin-bottom:0.2rem;text-shadow:2px 2px 8px rgba(0,0,0,0.06)}
  h2{font-size:1.4rem;font-weight:600;margin-bottom:0.6rem}
  p{font-size:1rem;line-height:1.6;margin-bottom:1.6rem;color:#555}
  .btn-home{display:inline-block;padding:.7rem 1.3rem;background:#2d9cdb;color:#fff;border-radius:6px;text-decoration:none;font-weight:600;transition:transform .12s,background .12s}
  .btn-home:hover{transform:translateY(-3px);background:#1b7cb8}
  .loader {
    margin: 16px auto 8px; width:44px; height:44px; border-radius:50%;
    border:5px solid rgba(45,156,219,0.16); border-top-color:#2d9cdb;
    animation: spin .6s linear infinite;
  }
  @keyframes spin {to{transform:rotate(360deg)}}
  .fade-out { opacity:0; transform: translateY(-6px) scale(.998); pointer-events:none; transition: opacity .06s ease, transform .06s ease; }
  .hint{font-size:0.9rem;color:#777;margin-top:8px}
  .link-row{display:flex;gap:10px;justify-content:center;margin-top:14px;flex-wrap:wrap}
  .small-btn{padding:.5rem .9rem;border-radius:6px;background:#efefef;color:#333;text-decoration:none;font-weight:600}
</style>
</head>
<body>
  <div id="notfound" role="main" aria-live="polite">
    <div class="icon">🔍</div>
    <h1>404</h1>
    <h2>페이지를 찾을 수 없어요</h2>
    <p>입력하신 주소가 잘못되었거나,<br>페이지가 삭제되었을 수 있습니다.</p>

    <div id="state-area">
      <div class="loader" id="loader" title="로딩중" aria-hidden="true"></div>
      <div class="hint" id="hint">상태를 확인 중입니다…</div>
    </div>

    <div class="link-row" style="margin-top:18px;">
      <a class="btn-home" id="home-btn" href="/space/">홈으로 돌아가기</a>
      <a class="small-btn" id="open-direct" href="/index.html" style="display:none">직접 index 열기</a>
    </div>
  </div>

<script>
/*
  정책:
  - 만약 현재 요청 경로가 정확히 /space/태양계정복(또는 /space/태양계정복/) 이면
      -> 즉시 /space/game.html 로 이동(location.replace)
  - 그 외 경로(실제 404)라면 404 디자인을 보여주고 주소창을 /space/error404 로 바꿔 표시(history.replaceState)
*/

(function(){
  const hint = document.getElementById('hint');
  const loader = document.getElementById('loader');
  const openDirect = document.getElementById('open-direct');

  // 현재 path, repo(첫 세그먼트)
  const pathname = location.pathname || '/';
  const parts = pathname.split('/').filter(Boolean);
  const repoSegment = parts.length >= 1 ? parts[0] : '';
  // 우리가 보여주길 원하는 error path: /<repo>/error404  (repo 없으면 /error404)
  const errorDisplayPath = repoSegment ? `/${repoSegment}/error404` : '/error404';

  // 사용자가 요청했을 때 즉시 이동시킬 정확한 path(요구대로)
  const immediatePaths = [
    '/space/태양계정복',
    '/space/태양계정복/'
  ];

  // 1) 만약 경로가 /space/태양계정복 이면 즉시 game.html로 이동
  if (immediatePaths.includes(pathname)) {
    // 즉시 이동: /space/game.html 로 replace
    // (game.html은 /space/game.html 위치에 올라가 있어야 함)
    try {
      // 사용자에게 대기 메시지 잠깐 보여주지 않도록 바로 replace
      location.replace('/space/game.html');
      return;
    } catch (e) {
      console.error('직접 이동 실패:', e);
      // 폴백: 노출된 404 디자인으로 진행
      loader.style.display = 'none';
      hint.textContent = '게임으로 이동할 수 없습니다. 아래 버튼으로 시도해 주세요.';
      openDirect.style.display = 'inline-block';
      return;
    }
  }

  // 2) 그 외 실제 404: 404 디자인 유지 + 주소창만 /<repo>/error404 로 보이게 변경
  try {
    history.replaceState(null, '', errorDisplayPath + location.hash);
  } catch (e) {
    // 무시
  }

  // 상태 표시 업데이트
  loader.style.display = 'none';
  hint.textContent = '요청하신 페이지를 찾을 수 없습니다. 주소를 확인해 주세요.';
  openDirect.style.display = 'inline-block';
  openDirect.href = repoSegment ? `/${repoSegment}/index.html` : '/index.html';
})();
</script>
</body>
</html>
