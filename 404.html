<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>404 â€¢ í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    display:flex;align-items:center;justify-content:center;
    background:#fafafa;font-family:'Raleway',sans-serif;color:#333;
    padding:1rem;
  }
  #notfound {
    width:100%;max-width:420px;padding:2rem;border-radius:10px;
    background:#fff;box-shadow:0 8px 24px rgba(0,0,0,0.08);
    text-align:center;position:relative;overflow:hidden;
    transition:opacity .12s ease, transform .12s ease;
  }
  .icon{font-size:4.5rem;margin-bottom:0.4rem;display:inline-block;animation:shake 1.6s infinite ease-in-out;}
  @keyframes shake{0%,100%{transform:rotate(0)}25%{transform:rotate(6deg)}75%{transform:rotate(-6deg)}}
  h1{font-family:'Fredoka One',cursive;font-size:4.8rem;color:#2d9cdb;margin-bottom:0.2rem;text-shadow:2px 2px 8px rgba(0,0,0,0.06)}
  h2{font-size:1.4rem;font-weight:600;margin-bottom:0.6rem}
  p{font-size:1rem;line-height:1.6;margin-bottom:1.6rem;color:#555}
  .btn-home{display:inline-block;padding:.7rem 1.3rem;background:#2d9cdb;color:#fff;border-radius:6px;text-decoration:none;font-weight:600;transition:transform .12s,background .12s}
  .btn-home:hover{transform:translateY(-3px);background:#1b7cb8}
  .loader {
    margin: 16px auto 8px; width:44px; height:44px; border-radius:50%;
    border:5px solid rgba(45,156,219,0.16); border-top-color:#2d9cdb;
    animation: spin .6s linear infinite;
  }
  @keyframes spin {to{transform:rotate(360deg)}}
  .fade-out { opacity:0; transform: translateY(-6px) scale(.998); pointer-events:none; transition: opacity .06s ease, transform .06s ease; }
  .hint{font-size:0.9rem;color:#777;margin-top:8px}
  .link-row{display:flex;gap:10px;justify-content:center;margin-top:14px;flex-wrap:wrap}
  .small-btn{padding:.5rem .9rem;border-radius:6px;background:#efefef;color:#333;text-decoration:none;font-weight:600}
</style>
</head>
<body>
  <div id="notfound" role="main" aria-live="polite">
    <div class="icon">ğŸ”</div>
    <h1>404</h1>
    <h2>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”</h2>
    <p>ì…ë ¥í•˜ì‹  ì£¼ì†Œê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜,<br>í˜ì´ì§€ê°€ ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div id="state-area">
      <div class="loader" id="loader" title="ë¡œë”©ì¤‘" aria-hidden="true"></div>
      <div class="hint" id="hint">ê²Œì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</div>
    </div>

    <div class="link-row" style="margin-top:18px;">
      <a class="btn-home" id="home-btn" href="/">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
      <a class="small-btn" id="open-direct" href="/index.html" style="display:none">ì§ì ‘ index ì—´ê¸°</a>
    </div>
  </div>

<script>
/*
ë™ì‘ ìš”ì•½:
- ë§Œì•½ ìš”ì²­ ê²½ë¡œê°€ /space/íƒœì–‘ê³„ì •ë³µ ë˜ëŠ” /space/íƒœì–‘ê³„ì •ë³µ/ ì´ê³ 
  (document.referrer ê°€ ë¹„ì–´ìˆê±°ë‚˜ ê°™ì€ originì—ì„œ ì™”ë‹¤ë©´)
    => ì¦‰ì‹œ /space/index.html (ìš°ì„ ) ë˜ëŠ” /index.html ì„ fetchí•´ì„œ ë°”ë¡œ ë¬¸ì„œ êµì²´ (ì§€ì²´ ì—†ìŒ).
  (í•˜ì§€ë§Œ document.referrer ê°€ ì™¸ë¶€ ë„ë©”ì¸ì´ë¼ë©´)
    => 404 ë””ìì¸ì„ ìœ ì§€í•˜ê³  ìë™ ì¦‰ì‹œ ì „í™˜í•˜ì§€ ì•ŠìŒ(ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥).
- ê·¸ ì™¸ ê²½ë¡œëŠ” ê¸°ì¡´ì˜ ë³‘ë ¬ ë¹ ë¥¸ ì „í™˜ ë¡œì§ ì‚¬ìš© (ê°€ì¥ ë¹¨ë¦¬ ì‘ë‹µí•œ index ë¡œ êµì²´).
*/

(async function(){
  const loader = document.getElementById('loader');
  const hint = document.getElementById('hint');
  const openDirect = document.getElementById('open-direct');
  const parts = location.pathname.split('/').filter(Boolean);

  // ì¦‰ì‹œ ì²˜ë¦¬ ëŒ€ìƒ ê²½ë¡œ
  const immediatePaths = ['/space/íƒœì–‘ê³„ì •ë³µ', '/space/íƒœì–‘ê³„ì •ë³µ/'];
  const currentPath = location.pathname;

  // referrer ì²´í¬: ì™¸ë¶€ì—ì„œ ì™”ëŠ”ì§€ í™•ì¸ (ì™¸ë¶€ì´ë©´ true)
  const ref = document.referrer || '';
  const isExternalReferrer = ref && !(ref.startsWith(location.origin));

  // helper: fetch text or null
  async function fetchTextOrNull(url) {
    try {
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error('bad ' + r.status);
      return await r.text();
    } catch (e) {
      return null;
    }
  }

  // ì¦‰ì‹œ ëŒ€ìƒ ê²½ë¡œì´ë©´ì„œ "ì™¸ë¶€ referrer ì•„ë‹˜" (ì¦‰ ì§ì ‘ ì ‘ê·¼ ë˜ëŠ” ê°™ì€ originì—ì„œ ì˜¨ ê²½ìš°)
  if (immediatePaths.includes(currentPath) && !isExternalReferrer) {
    hint.textContent = 'ìƒˆë¡œê³ ì¹¨/ì§ì ‘ì ‘ê·¼ ê°ì§€ â€” ë°”ë¡œ ê²Œì„ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦';
    // ìˆ¨ê¹€ ì²˜ë¦¬(ì§€ì²´ì—†ì´)
    loader.style.display = 'none';

    // ìš°ì„  ì‹œë„: /space/index.html
    let html = await fetchTextOrNull('/space/index.html');
    if (!html) html = await fetchTextOrNull('/index.html');

    if (html) {
      try {
        document.open();
        document.write(html);
        document.close();
        try { history.replaceState(null, '', location.pathname + location.hash); } catch(e){}
        return;
      } catch (e) {
        console.error('ì¦‰ì‹œ ë¬¸ì„œ êµì²´ ì‹¤íŒ¨:', e);
        try { location.replace('/space/index.html'); } catch(e){ location.replace('/index.html'); }
        return;
      }
    } else {
      // ì¦‰ì‹œ ì‹œë„ ì‹¤íŒ¨ -> í´ë°±ìœ¼ë¡œ ì¼ë°˜ íë¦„ ê³„ì†
      loader.style.display = '';
      hint.textContent = 'ì¦‰ì‹œ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìë™ ì‹œë„ë¥¼ ê³„ì†í•©ë‹ˆë‹¤â€¦';
    }
  } else if (immediatePaths.includes(currentPath) && isExternalReferrer) {
    // ì¦‰ì‹œ ëŒ€ìƒ ê²½ë¡œì´ì§€ë§Œ ì™¸ë¶€ì—ì„œ ë§í¬ë¡œ ì™”ë‹¤ë©´ 404 ë””ìì¸ì„ ë³´ì—¬ì£¼ê³  ìë™ ì¦‰ì‹œ ë¡œë“œëŠ” í•˜ì§€ ì•ŠìŒ
    loader.style.display = 'none';
    hint.textContent = 'ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ì…¨ìŠµë‹ˆë‹¤ â€” ì´ í˜ì´ì§€ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
    openDirect.style.display = 'inline-block';
    openDirect.href = '/index.html';
    return; // ì•„ë¬´ ìë™ ì „í™˜ ì—†ì´ ë””ìì¸ ìœ ì§€
  }

  // ===== ì¼ë°˜ ë¹ ë¥¸ ë³‘ë ¬ ì‹œë„ =====
  const candidates = ['/index.html'];
  if (parts.length >= 1) candidates.push('/' + parts[0] + '/index.html');
  const up = location.pathname.replace(/\/+$/, '').replace(/\/[^\/]+$/, '');
  if (up && up !== '/') candidates.push((up.endsWith('/') ? up : up + '/') + 'index.html');

  const uniq = Array.from(new Set(candidates));

  function fetchText(url) {
    return fetch(url, {cache:'no-store'}).then(r => {
      if (!r.ok) throw new Error('bad ' + r.status);
      return r.text().then(t => ({url, text:t}));
    });
  }

  let result = null;
  try {
    const promises = uniq.map(u => fetchText(u));
    if (typeof Promise.any === 'function') {
      result = await Promise.any(promises);
    } else {
      // Promise.any ì—†ëŠ” í™˜ê²½ í´ë°±
      result = await (async () => {
        return await new Promise((resolve, reject) => {
          let rejs = 0;
          promises.forEach(p => p.then(resolve).catch(_ => {
            rejs++;
            if (rejs === promises.length) reject(new AggregateError([], 'All rejected'));
          }));
        });
      })();
    }
  } catch (e) {
    loader.style.display = 'none';
    hint.textContent = 'í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì‹œë„í•´ ë³´ì„¸ìš”.';
    openDirect.style.display = 'inline-block';
    if (parts.length >= 1) {
      const repoIndex = '/' + parts[0] + '/index.html';
      hint.textContent += ' (ë˜ëŠ” ' + repoIndex + ' ì‹œë„)';
    }
    return;
  }

  try {
    document.getElementById('notfound').classList.add('fade-out');
    await new Promise(res => setTimeout(res, 60));
    document.open();
    document.write(result.text);
    document.close();
    try { history.replaceState(null, '', location.pathname + location.hash); } catch(e){}
  } catch (err) {
    console.error('ì „í™˜ ì‹¤íŒ¨:', err);
    try { location.replace(result.url || '/index.html'); } catch(e){}
  }
})();
</script>
</body>
</html>
