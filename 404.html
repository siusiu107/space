<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>404 â€¢ í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    display:flex;align-items:center;justify-content:center;
    background:#fafafa;font-family:'Raleway',sans-serif;color:#333;
    padding:1rem;
  }
  #notfound {
    width:100%;max-width:420px;padding:2rem;border-radius:10px;
    background:#fff;box-shadow:0 8px 24px rgba(0,0,0,0.08);
    text-align:center;position:relative;overflow:hidden;
    transition:opacity .45s ease, transform .45s ease;
  }
  .icon{font-size:4.5rem;margin-bottom:0.4rem;display:inline-block;animation:shake 2s infinite ease-in-out;}
  @keyframes shake{0%,100%{transform:rotate(0)}25%{transform:rotate(6deg)}75%{transform:rotate(-6deg)}}
  h1{font-family:'Fredoka One',cursive;font-size:4.8rem;color:#2d9cdb;margin-bottom:0.2rem;text-shadow:2px 2px 8px rgba(0,0,0,0.06)}
  h2{font-size:1.4rem;font-weight:600;margin-bottom:0.6rem}
  p{font-size:1rem;line-height:1.6;margin-bottom:1.6rem;color:#555}
  .btn-home{display:inline-block;padding:.7rem 1.3rem;background:#2d9cdb;color:#fff;border-radius:6px;text-decoration:none;font-weight:600;transition:transform .18s,background .18s}
  .btn-home:hover{transform:translateY(-3px);background:#1b7cb8}
  /* ë¡œë”© ì¸ë””ì¼€ì´í„° */
  .loader {
    margin: 18px auto 8px; width:48px; height:48px; border-radius:50%;
    border:5px solid rgba(45,156,219,0.18); border-top-color:#2d9cdb;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {to{transform:rotate(360deg)}}
  /* ìˆ¨ê¸°ê¸° ì „í™˜ */
  .fade-out { opacity:0; transform: translateY(-12px) scale(.995); pointer-events:none; }
  /* ì‘ì€ ì•ˆë‚´ í…ìŠ¤íŠ¸ */
  .hint{font-size:0.9rem;color:#777;margin-top:8px}
  /* ë§í¬ í–‰ */
  .link-row{display:flex;gap:10px;justify-content:center;margin-top:14px;flex-wrap:wrap}
  .small-btn{padding:.5rem .9rem;border-radius:6px;background:#efefef;color:#333;text-decoration:none;font-weight:600}
</style>
</head>
<body>
  <div id="notfound" role="main" aria-live="polite">
    <div class="icon">ğŸ”</div>
    <h1>404</h1>
    <h2>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”</h2>
    <p>ì…ë ¥í•˜ì‹  ì£¼ì†Œê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜,<br>í˜ì´ì§€ê°€ ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <!-- ë¡œë”/ìƒíƒœ -->
    <div id="state-area">
      <div class="loader" id="loader" title="ë¡œë”©ì¤‘" aria-hidden="true"></div>
      <div class="hint" id="hint">ê²Œì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>
    </div>

    <div class="link-row" style="margin-top:18px;">
      <a class="btn-home" id="home-btn" href="/">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
      <a class="small-btn" id="open-direct" href="/index.html" style="display:none">ì§ì ‘ index ì—´ê¸°</a>
    </div>
  </div>

<script>
/*
  ë™ì‘:
  1) ì—¬ëŸ¬ í›„ë³´ ê²½ë¡œì—ì„œ index.htmlì„ ì‹œë„(fetch)
     - /index.html
     - /<repo>/index.html   (ì²« path segment ì‚¬ìš©)
     - í˜„ì¬ ê²½ë¡œì˜ ìƒìœ„ index.html (fallback)
  2) ê°€ì ¸ì˜¤ë©´ 404 ë””ìì¸ì„ í˜ì´ë“œì•„ì›ƒ ì‹œí‚¨ ë’¤ document.writeë¡œ index.html ì „ì²´ë¥¼ êµì²´
     (ì´ ë°©ì‹ì€ index.html ë‚´ì˜ ìŠ¤í¬ë¦½íŠ¸/ëª¨ë“ˆì´ ì •ìƒ ì‹¤í–‰ë˜ë„ë¡ í•¨)
  3) ì‹¤íŒ¨í•˜ë©´ 404 ë””ìì¸ì„ ìœ ì§€í•˜ê³  ì‚¬ìš©ìì—ê²Œ ìˆ˜ë™ ë§í¬ ì œê³µ
*/

(async function(){
  const loader = document.getElementById('loader');
  const hint = document.getElementById('hint');
  const openDirect = document.getElementById('open-direct');
  const homeBtn = document.getElementById('home-btn');

  // ìœ í‹¸: fetch text, ì‹¤íŒ¨ ì‹œ null ë°˜í™˜
  async function tryFetchText(url){
    try {
      const r = await fetch(url, {cache: 'no-store'});
      if (!r.ok) throw new Error('not ok: ' + url + ' ('+r.status+')');
      return await r.text();
    } catch (e) {
      return null;
    }
  }

  // í›„ë³´ ê²½ë¡œ ë°°ì—´ ìƒì„±
  const candidates = [];
  // 1) ë£¨íŠ¸ index
  candidates.push('/index.html');

  // 2) repo í˜•íƒœ: /<first-segment>/index.html
  const parts = location.pathname.split('/').filter(Boolean);
  if (parts.length >= 1) {
    candidates.push('/' + parts[0] + '/index.html');
  }

  // 3) ìƒìœ„ ë””ë ‰í† ë¦¬ index (ì˜ˆ: /repo/space/... -> /repo/index.html)
  const up = location.pathname.replace(/\/+$/, '').replace(/\/[^\/]+$/, '');
  if (up && up !== '/') {
    candidates.push((up.endsWith('/') ? up : up + '/') + 'index.html');
  }

  // ì¤‘ë³µ ì œê±°
  const tried = [];
  const uniqCandidates = candidates.filter(c => { if (tried.includes(c)) return false; tried.push(c); return true; });

  // ì‹œë„ ì‹œì‘
  hint.textContent = 'ê²Œì„ íŒŒì¼ì„ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦';
  let foundHtml = null;
  let foundUrl = null;
  for (const url of uniqCandidates) {
    hint.textContent = `index.html ì‹œë„: ${url}`;
    const txt = await tryFetchText(url);
    if (txt) { foundHtml = txt; foundUrl = url; break; }
  }

  if (!foundHtml) {
    // ì‹¤íŒ¨: ì•ˆë‚´ ë° ì§ì ‘ ì—´ê¸° ë§í¬ í‘œì‹œ
    loader.style.display = 'none';
    hint.textContent = 'í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì‹œë„í•´ ë³´ì„¸ìš”.';
    openDirect.style.display = 'inline-block';
    // openDirect hrefëŠ” ë¨¼ì € /index.htmlë¡œ, ë§Œì•½ repoí˜•íƒœë©´ ê·¸ìª½ë„ ì‹œë„í•˜ê²Œ í•¨
    openDirect.href = '/index.html';
    // ë§Œì•½ ì²« segmentê°€ ìˆìœ¼ë©´ repo index ë§í¬ë„ ì œê³µ
    if (parts.length >= 1) {
      const repoIndex = '/' + parts[0] + '/index.html';
      // í™ˆ ë²„íŠ¼ì„ repoIndexë¡œ ë°”ê¿”ë„ ë˜ì§€ë§Œ ê¸°ë³¸ì€ ë£¨íŠ¸ ìœ ì§€
      // ëŒ€ì‹  hintì— repoIndex ì œì•ˆ
      hint.textContent += ' (ë˜ëŠ” ' + repoIndex + ' ì‹œë„)';
      openDirect.href = '/index.html'; // ê¸°ë³¸
    }
    return;
  }

  // ì„±ê³µ: foundHtmlì— index.html í…ìŠ¤íŠ¸ ë‹´ê²¨ìˆìŒ
  // ë¶€ë“œëŸ¬ìš´ ì „í™˜: 404 ë°•ìŠ¤ í˜ì´ë“œì•„ì›ƒ í›„ document.writeë¡œ êµì²´
  try {
    hint.textContent = 'ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦';
    document.getElementById('notfound').classList.add('fade-out');

    // í˜ì´ë“œ ì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚  ë•Œê¹Œì§€ ì ê¹ ëŒ€ê¸° (450ms ê¸°ì¤€)
    await new Promise(res => setTimeout(res, 480));

    // ë¬¸ì„œ êµì²´ â€” URLì€ ìœ ì§€
    try {
      document.open();
      document.write(foundHtml);
      document.close();
      // historyëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•´ì„œ ì‚¬ìš©ìê°€ ë³¸ë˜ ìš”ì²­í•œ URLì´ ì£¼ì†Œì°½ì— ë‚¨ê²Œ í•¨
      try { history.replaceState(null, '', location.pathname + location.hash); } catch(e){}
    } catch (e) {
      // ì•ˆì „í•˜ê²Œ ê°•ì œ ë¦¬ë””ë ‰íŠ¸ (ìµœí›„ ìˆ˜ë‹¨)
      console.error('document.write ì‹¤íŒ¨:', e);
      location.replace(foundUrl || '/index.html');
    }
  } catch (e) {
    console.error('ì „í™˜ ì¤‘ ì˜¤ë¥˜:', e);
    // ì˜¤ë¥˜ì‹œ ì•ˆì „í•˜ê²Œ indexë¡œ ì´ë™
    location.replace(foundUrl || '/index.html');
  }
})();
</script>
</body>
</html>
